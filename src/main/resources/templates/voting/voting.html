<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vote</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <main>
        <nav class="breadcrumb">
            <a href="/management">← Back to all polls</a>
        </nav>

        <!-- Poll card with inline fragment -->
        <div id="poll-card" th:fragment="poll-card" class="poll-card">
            <h1 th:text="${poll.question}"></h1>

            <!-- Show voting form if not voted -->
            <form th:if="${!hasVoted}"
                  th:attr="hx-post=@{/voting/{id}/vote(id=${poll.id})}"
                  hx-target="#poll-card"
                  hx-swap="outerHTML"
                  class="vote-form">
                <fieldset>
                    <legend>Select an option:</legend>
                    <div class="options-list" th:each="option : ${poll.options}">
                        <label class="option-label">
                            <input type="radio" name="optionId"
                                   th:value="${option.id}" required>
                            <span th:text="${option.text}"></span>
                        </label>
                    </div>
                </fieldset>
                <button type="submit" class="btn-primary">Submit Vote</button>
            </form>

            <!-- Show confirmation if voted -->
            <div th:if="${hasVoted}" class="vote-confirmation">
                <p class="confirmation-message">✓ You voted for: <strong th:text="${votedOption}"></strong></p>
                <div class="confirmation-actions">
                    <a th:href="@{/results/{id}(id=${poll.id})}" class="btn-link">View Results</a> |
                    <a href="/management" class="btn-link">Back to all polls</a>
                </div>
            </div>
        </div>
    </main>
</body>
</html>
